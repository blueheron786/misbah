@namespace Misbah.BlazorDesktop.Components.Pages.Notes
@using Misbah.Domain.Entities
@using Misbah.Application.DTOs
@using Misbah.BlazorDesktop.Components.Pages.Notes
@using Misbah.BlazorDesktop.Resources
@inject Misbah.Application.Interfaces.INoteService NoteService
@inject Misbah.Application.Interfaces.IFolderService FolderService
@inject NavigationManager Navigation
<div class="sidebar-panel-wrapper">
    <button @onclick="() => _showFolders = !_showFolders" class="toggle-panel-btn">
        @(_showFolders ? AppStrings.HideFolders : AppStrings.ShowFolders)
    </button>
    @if (_showFolders)
    {
        <FolderTree RootPath="@RootPath" OnNoteSelected="SelectNote" />
    }
    <h3>@AppStrings.Notes</h3>
    <ul>
        @if (_notes != null)
        {
            foreach (var note in _notes)
            {
                <li @onclick="() => SelectNote(note.Id)" class="@(_selectedNoteId == note.Id ? "selected" : "")">
                    @note.Title
                </li>
            }
        }
        else
        {
            <li><em>@AppStrings.NoNotesFound</em></li>
        }
    </ul>
</div>
@code {
    [Parameter] public string? RootPath { get; set; }
    private List<NoteDto>? _notes;
    private FolderNodeDto? _folderTree;
    private string? _selectedNoteId;
    private bool _showFolders = true;

    protected override async Task OnInitializedAsync()
    {
        if (!string.IsNullOrEmpty(RootPath))
        {
            _folderTree = await FolderService.GetFolderByPathAsync(RootPath);
            var notes = await NoteService.GetAllNotesAsync();
            _notes = notes.ToList();
        }
    }

    public void SelectNote(string id)
    {
        _selectedNoteId = id;
    Navigation.NavigateTo($"/notes/{Uri.EscapeDataString(id)}");
    }
}
