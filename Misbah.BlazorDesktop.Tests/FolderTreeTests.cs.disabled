using System.Collections.Generic;
using Bunit;
using NUnit.Framework;
using Misbah.BlazorDesktop.Components.Pages.Notes;
using Misbah.Core.Models;
using Misbah.Core.Services;
using Microsoft.Extensions.DependencyInjection;
using NSubstitute;

namespace Misbah.BlazorDesktop.Tests;

[TestFixture]
public class FolderTreeTests : Bunit.TestContext
{
    [Test]
    public void Renders_Folder_And_Notes()
    {
        // Arrange
        var folder = new FolderNode
        {
            Name = "root",
            Path = "root",
            Folders = new List<FolderNode> { new FolderNode { Name = "sub", Path = "root/sub" } },
            Notes = new List<Note> { new Note { Id = "n1", Title = "Note 1", FilePath = "n1" } }
        };
        var folderService = Substitute.For<IFolderService>();
        folderService.LoadFolderTree(Arg.Any<string>()).Returns(folder);
        Services.AddSingleton(folderService);

        // Act
        var cut = RenderComponent<FolderTree>(parameters => parameters.Add(p => p.RootPath, "root"));

        // Assert
        Assert.That(cut.Markup, Does.Contain("root"));
        Assert.That(cut.Markup, Does.Contain("sub"));
        Assert.That(cut.Markup, Does.Contain("Note 1"));
    }
}
