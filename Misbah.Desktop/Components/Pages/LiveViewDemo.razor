@page "/demo/liveview"
@using Misbah.Desktop.Components.Pages.Notes

<PageTitle>Live View Markdown Demo</PageTitle>

<div style="padding: 20px;">
    <h1>Live View Markdown Editor Demo</h1>
    <p>This demonstrates the Obsidian-style live view markdown editing feature.</p>
    
    <div style="margin: 20px 0;">
        <button class="btn btn-primary" @onclick="LoadSampleContent">Load Sample Content</button>
        <button class="btn btn-secondary" @onclick="ClearContent">Clear Content</button>
        <button class="btn btn-outline-primary" @onclick="ToggleTheme">
            Toggle Theme (@currentTheme)
        </button>
    </div>

    <div style="border: 1px solid #ddd; border-radius: 8px; overflow: hidden;">
        <LiveViewMarkdownEditor @ref="editorRef"
                                Content="@content"
                                ContentChanged="OnContentChanged"
                                Height="600px"
                                Theme="@currentTheme" />
    </div>

    <div style="margin-top: 20px;">
        <h3>Instructions:</h3>
        <ul>
            <li>Click on any rendered content to edit it inline</li>
            <li>Press Ctrl+Enter to finish editing</li>
            <li>Press Escape to cancel editing</li>
            <li>Click the "+" button to add new content blocks</li>
            <li>The editor automatically detects block types (headings, paragraphs, code, etc.)</li>
        </ul>
    </div>

    @if (!string.IsNullOrEmpty(content))
    {
        <div style="margin-top: 20px;">
            <h3>Raw Markdown Output:</h3>
            <pre style="background: #f5f5f5; padding: 15px; border-radius: 4px; overflow-x: auto; font-family: monospace; font-size: 12px;">@content</pre>
        </div>
    }
</div>

@code {
    private LiveViewMarkdownEditor? editorRef;
    private string content = "";
    private string currentTheme = "light";

    private string sampleContent = @"# Welcome to Live View Markdown!

This is a **demonstration** of the Obsidian-style live view markdown editor. You can click on any element to edit it directly.

## Features

- Click any text to edit it inline
- Real-time markdown rendering
- Support for all markdown elements
- Keyboard shortcuts for productivity

### Code Blocks

```csharp
public class Example
{
    public string Message { get; set; } = ""Hello, World!"";
}
```

### Lists and Tasks

- Regular list item
- Another item with *emphasis*

Task list:
- [ ] This is an uncompleted task
- [x] This task is completed
- [ ] Another task to do

### Quotes

> This is a blockquote that demonstrates how quotes are rendered and can be edited inline.

### Table Example

| Feature | Status | Notes |
|---------|--------|-------|
| Inline editing | ✅ | Click to edit |
| Real-time preview | ✅ | As you type |
| Theme support | ✅ | Light and dark |

---

**Try it out!** Click on any element above to start editing.";

    private Task OnContentChanged(string newContent)
    {
        content = newContent;
        StateHasChanged();
        return Task.CompletedTask;
    }

    private Task LoadSampleContent()
    {
        content = sampleContent;
        StateHasChanged();
        return Task.CompletedTask;
    }

    private Task ClearContent()
    {
        content = "";
        StateHasChanged();
        return Task.CompletedTask;
    }

    private Task ToggleTheme()
    {
        currentTheme = currentTheme == "light" ? "dark" : "light";
        StateHasChanged();
        return Task.CompletedTask;
    }
}
